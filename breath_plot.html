  <!--
    Breath Plot: COVID-19 Respiration Analysis Software
    Copyright (C) 2021  Robert L. Read

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/standard.css" media="screen"/>
    <title>Public Invention Respiration Analysis</title>
  </head>
  <body>
    <div class="container-fluid">
      <!-- HEADER -->
      <div id="preamble">
        <!-- TITLE AND DESCRIPTION -->
        <table style="width:100%; margin-bottom:2.5px;">
          <tr>
            <td style="width:33%">
              <h1 class="new-header">VentMon Respiration Analysis</h1>
            </td>
            <td class="new-header-text">
              This is a work in progress of <a href="https://www.pubinv.org">Public Invention</a>. It can be attached to a data server to produce an interactive or static analysis of a respiration. It&#39;s primary purpose is to test pandemic ventilators, but it is free software meant to be reused for other purposes.
            </td>
          </tr>
        </table>
        <!-- HEADER INPUT TOP ROW -->
        <div class="input-group livecon center-vert-group">
          <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon3">PIRDS data server (or VentOS API) url:</span>
          </div>
          <input type="text" class="add-right-margin form-control top-input-bar" id="dserverurl" aria-describedby="basic-addon3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon3">Trace ID:</span>
          </div>
          <input type="text" class="add-right-margin form-control top-input-bar" id="traceid" aria-describedby="basic-addon3">
          <div class="input-group-prepend">
            <span class="input-group-text" for="samples_to_plot">Number of Samples (~10s per 15000 samples):</span>
          </div>
          <input type="text" class="form-control top-input-bar" id="samples_to_plot" aria-describedby="samples_to_plot">
          <!-- a class="btn btn-outline-dark btn-sm" href="#" role="button" id="useofficial">Use Ventmon Data Lake: ventmon.coslabs.com</a -->
        </div>
        <!-- HEADER INPUT BOTTOM ROW -->
        <div class="btn-group  livecon buttons-and-time" role="group" aria-label="Basic example">
          <div id="timetop">
            <div class="alert alert-info" role="alert" id="time_start">
              Time of first sample
            </div>
            <div class="alert alert-info" role="alert" id="time_finish">
              Time of last sample
            </div>
          </div>
          <div class="header-toggles">
            <label for="livetoggle  livecon" class="top-toggle-text">Use VentOS API</label>
            <label class="switch  livecon">
            <input type="checkbox" id="simulation" checked>
            <span class="slider round"></span>
            </label>
            <label for="livetoggle  livecon" class="top-toggle-text">Plot Live</label>
            <label class="switch  livecon">
            <input type="checkbox" id="livetoggle" checked>
            <span class="slider round"></span>
            </label>
            <label for="livetoggle  livecon" class="top-toggle-text">Use Clinical Display</label>
            <label class="switch  livecon">
            <input type="checkbox" id="clinical_display" unchecked>
            <span class="slider round"></span>
            </label>
          </div>
          <button type="button" class="btn btn-primary" id="5s_btn">5s</button>
          <button type="button" class="btn btn-primary" id="10s_btn">10s</button>
          <button type="button" class="btn btn-primary" id="15s_btn">15s</button>
          <button type="button" class="btn btn-primary" id="30s_btn">30s</button>
          <button type="button" class="btn btn-primary" id="60s_btn">60s</button>
          <button type="button" class="btn btn-primary" id="120s_btn">120s</button>
          <button type="button" class="btn btn-primary" id="180s_btn">180s</button>
          <button type="button" class="btn btn-primary" id="300s_btn">300s</button>
        </div>
      </div>
      <!-- MAIN CONTENT -->
      <div>
        <div id="main-content-div" >
          <div id="data-area" class="container-fluid">
            <div class="row">
              <div class="col-9">
                <div id='PFGraph'>
                  <!-- PRESSURE AND FLOW GRAPH -->
                </div>
                <div id='EventsGraph'>
                  <!-- EVENTS -->
                </div>
                <!-- CIRCULAR SLIDERS -->
                <div class="flex settings_area">
                  <div class="toggle-switch-container">
                    <div class="toggle-switch switch-vertical">
                      <input id="toggle-a" type="radio" name="switch" checked="checked" />
                      <label for="toggle-a">PCV</label>
                      <input id="toggle-b" type="radio" name="switch" />
                      <label for="toggle-b">VCV</label>
                      <span class="toggle-outside">
                        <span class="toggle-inside"></span>
                      </span>
                    </div>
                  </div>
                  <div id="slider-row">
                    <div style="width:170px; margin-right:10px;">
                      <div id="pmax-slider"></div>
                      <div style="display:flex; justify-content: space-between;">
                        <p class="minmaxnum" style="margin-left:47.5px; margin-right:5px;">0</p>
                        <p class="cslidelabel">PMAX</p>
                        <p class="minmaxnum" style="margin-right:47.5px;">80</p>
                      </div>
                    </div>
                  </div>
                  <div id="slider-row">
                    <div style="width:170px; margin-right:10px;">
                      <div id="tv-slider"></div>
                      <div style="display:flex; justify-content: space-between;">
                        <p class="minmaxnum" style="margin-left:47.5px; margin-right:5px;">5</p>
                        <p class="cslidelabel">TV</p>
                        <p class="minmaxnum" style="margin-right:47.5px;">80</p>
                      </div>
                    </div>
                  </div>
                  <div id="slider-row">
                    <div style="width:170px; margin-right:10px;">
                      <div id="rr-slider"></div>
                      <div style="display:flex; justify-content: space-between;">
                        <p class="minmaxnum" style="margin-left:47.5px; margin-right:5px;">3</p>
                        <p class="cslidelabel">RR</p>
                        <p class="minmaxnum" style="margin-right:47.5px;">60</p>
                      </div>
                    </div>
                  </div>
                  <div id="slider-row">
                    <div style="width:170px; margin-right:10px;">
                      <div id="ie-slider"></div>
                      <div style="display:flex; justify-content: space-between;">
                        <p class="minmaxnum" style="margin-left:47.5px">2</p>
                        <p class="cslidelabel">IE</p>
                        <p class="minmaxnum" style="margin-right:47.5px;">.1</p>
                      </div>
                    </div>
                  </div>
                  <div id="slider-row">
                    <div style="width:170px; margin-right:10px;">
                      <div id="peep-slider"></div>
                      <div style="display:flex; justify-content: space-between;">
                        <p class="minmaxnum" style="margin-left:47.5px; margin-right:5px;">0</p>
                        <p class="cslidelabel">PEEP</p>
                        <p class="minmaxnum" style="margin-right:47.5px;">20</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- RIGHT SIDEBAR -->
              <div class="col-3">
                <div class="alert alert-danger" role="alert" id="main_alert">
                  Danger! Flow limits exceeded; volumes will be incorrect.
                </div>
                <div id="calcarea">
                  <div>
                    <p class="obs-title">PIP (max):</p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="pipmax" class="obs-value" style="display:inline;">40</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">80</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">0</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="engineering_only">
                    <p class="obs-title">P. Mean:</p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="pipavg" class="obs-value" style="display:inline;">35</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">80</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">5</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div>
                    <p class="obs-title">PEEP (min):</p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="pipmin" class="obs-value" style="display:inline;">10</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">20</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">0</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div>
                    <p class="obs-title">MVs (l/min):</p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="mv" class="obs-value" style="display:inline;">0</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">10</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">1</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div>
                    <p class="obs-title">RR:</p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="bpm" class="obs-value" style="display:inline;">28</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">60</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">3</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div>
                    <p class="obs-title">I:E ratio: </p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="inhalationtoexhalation" class="obs-value" style="display:inline;">1</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">2</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">.1</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div>
                    <p class="obs-title">VTd (ml): </p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="tidalvolume" class="obs-value" style="display:inline;">0</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">80</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">20</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="engineering_only">
                    <p class="obs-title">FiO2 Mean (%): </p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="fioxygen2" class="obs-value" style="display:inline;">0</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">100</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">18</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="engineering_only">
                    <p class="obs-title">Rise Time (ms): </p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="timeachieve-ip" class="obs-value" style="display:inline;">0</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">100</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">0</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="engineering_only">
                    <p class="obs-title">Fall Time (ms): </p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="timereleaseinspiratory-pressure" class="obs-value" style="display:inline;">0</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">100</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">0</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="engineering_only">
                    <p class="obs-title">W. of B. (J/L): </p>
                    <div style="display:flex; justify-content: space-between;">
                      <p id="workofbreathing" class="obs-value" style="display:inline;">0</p>
                      <div style="display:inline; font-size:10px;">
                        <div style="display:block;">
                          <p style="display: inline;">H: </p>
                          <div class="obs-max" style="display:inline;">3</div>
                        </div>
                        <div style="display:inline;">
                          <p style="display: inline;">L: </p>
                          <div class="obs-min" style="display:inline;">.2</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- SCRIPTS TO LOAD GRAPHS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
    <script>
      const SEVENINCHEL14TS = false;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/round-slider@1.5.1/dist/roundslider.min.js"></script>
    <script src='js/respiraworks_to_PIRDS.js'></script>
    <script src='js/respiration_math.js'></script>
    <script src='js/PIRDS_utilities.js'></script>
    <script src='js/breath_plot_ctl.js'></script>
  </body>
</html>
